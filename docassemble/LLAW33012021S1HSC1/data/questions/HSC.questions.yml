imports:
  - json
---
features:
  css: HSC.css
---
objects from file:
# Postcodes information is from a database by Matthew Proctor, available
# at https://www.matthewproctor.com/full_australian_postcodes_sa
# 
# **It will eventually need to be updated**
# 
# The data was copy-pasted into excel, converted to a CSV file containing only
# the Postcode and Locality columns, and then a Find+Replace run on
# this CSV file using Notepad++ & Regex:
#   Find: ^(\d+),(.+)$
#   Replace with: \t{"postcode": "$1", "placename": "$2"}
# Then start & end characters were added manually:
#   Start: [
#   End: ]
# And finally the last comma in the list was removed, producing
# a valid json file to use here.
  - postcodes: HSC.json
---
initial: True
code: |
  log("var HSCcouncil = " + json.dumps(postcodes.as_serializable()) + ";", "javascript")
---
mandatory: true
question: |
  Location
subquestion: |

  Please enter your clients postcode and then select a relevant council. 
  If two council areas come up refer to cheat sheet/hint. 
  
  <span id="postcode-input-container">[FIELD HSCcouncil]</span>
  
  <div id="postcodes-list"></div>
fields:
  - Council area: HSCcouncil
script: |
  <script>
    const resultsLimit = 20;
    
    const postcodeInputSpan = document.getElementById('postcode-input-container');
    const postcodeInput = postcodeInputSpan.getElementsByClassName('dainput-embedded')[0];
    const postcodesList = document.getElementById('postcodes-list');
    
    postcodeInput.addEventListener('input', updateSearchList);
    
    function updateSearchList(e) {
      const searchQuery = e.target.value.replace(/\W/g, '');
      
      if (searchQuery.length == 0) {
        postcodesList.innerHTML = '';
        return;
      }
      
      const searchRegex = new RegExp(searchQuery, 'i');
      
      let results = [];
      for (i = 0; i < HSCcouncil.elements.length; i++) {
        const entry = HSCcouncil.elements[i];
        const entrySearchText = (entry.postcode + entry.placename).replace(/\W/g, '');
        if (searchRegex.test(entrySearchText)) {
          results.push(entry);
        }
        if (results.length >= resultsLimit) {
          break;
        }
      }
      
      postcodesList.innerHTML = results.map(r => '<p><div class="btn btn-da btn-info postcode-search-result" onclick="selectPostcode(' + r.postcode + ')">' + r.postcode + ': ' + r.placename + '</div></p>').join('');
    }
    
    function selectPostcode(postcode) {
      postcodeInput.value = postcode;
      postcodesList.innerHTML = '';
    }
  </script>
---
# Initial screen as per revised flow chat
field: welcome_screen
question: Welcome
subquestion: |
  Welcome to the Hutt Street Centre Community Access Tool.
  
  The tool can help you make a list of relevant community services for a client. It will filter community services based on council area and information about the client.
  
  What do you want to do?
  
  Click 'Tool' to start.
  
  Click 'Administration' to update the service list.
  
buttons:
  - Tool: proceed
  - Administration: signin
sets: HSCsign_in_page
---
# LHS Welcome Screen -- system admin pathway
question: Edit Service List
subquestion: |
  
  To make a change to the services you need to change the master file. 
  
  Upload the {CSV} file to make the changes in the tool. 
  
  It is important that you have consent to make changes.
   
  ***Disclaimer:***   
  There is no way to recover lost data. Flinders University is not responsible for lost data. 
  
  Do you have consent to make changes?
yesno: HSCadmineligible

terms:
  CSV: You can use the template CSV file named HSC2TEMPLATE.csv to input data and the appropriate information. 
progress: 25
---
# Confirmation screen when uploading CSV data to the system
question: Confirm Upload
subquestion: |
  
  Confirm you would like to upload the new file. 
  
  If you proceed, the current data will be overwritten.
  File being uploaded is **${csv_import[0].filename}**.
  
  No changes will be made if you do not confirm.
yesno: HSCadminupload
progress: 75
---
# RHS Welcome Screen -- regular user pathway
question: Community Services Tool
subquestion: |
  
  This tool can help you make a list of relevant community services for a client. It will filter community services based on council area and information about the client.
 
  ***Disclaimer:***   
  This is a guide only and may not include all services.
  There are no guarantees that any individual service will accept your clients enquiry or provide services to them.
  
  Do you accept these terms?
yesno: HSCeligible
progress: 1

---
# Gender question
question: |
  Gender
subquestion: |
  Which gender below best describes the client?
  
  Choose 'Other' if male or female does not describe them.
  
  If the client chooses not to disclose their gender, this may effect the service outcome.
  
  If they do not want to share, choose 'Prefer not to say'.
fields: 
  - no label: HSCgender
    datatype: radio
    choices:
     - "Female": Female
     - "Male": Male
     - "Other or Prefer not to say": Other
    default: |
      Female
progress: 30
---
# Age question
question: |
  Age
subquestion: |
  What is the client's age?
fields:
  Age: HSCage
  datatype: integer
  min: 0
  max: 100
  validation messages: 
    max: |
      Please enter an age between 0 and 100
  default: |
    36
progress: 40
---
# Children question
question: |
  Children
subquestion: |
  Does the client have any children under 18 years of age in their {care}?
yesno: HSCchildren
terms:
  care: A child or children are in a clients care if they have custody of or live with them
progress: 50
---
# ATSI question
question: |
  Aboriginal or Torres Strait Islander
subquestion: | 
  Is the client of Aboriginal or Torres Strait Islander descent?
yesno: HSCatsi
progress: 60
---
# Concessions question
question: |
  Concessions
subquestion: |
  Which concessions is the client eligible for?
  
  You can choose as many as you need. 
  
  If you are unsure, please select 'None of the above'.
fields: 
  - no label: HSCconcession
    datatype: checkboxes
    choices:
     - "Health Care Card"
     - "Seniors Card"
     - "Department of Veteran Affairs Card"
     - "Disability Support Pension"
     - "Student"
    default: |
      Health Care Card
progress: 70
---
# Other factors question
question: |
  Other Factors
subquestion: | 
  Which of the below apply to the client?
  
  You can choose as many as you need. 
  
  If you are unsure, please select 'None of the above'.
fields: 
  - no label: HSCfactor
    datatype: checkboxes
    choices:
     - "Disability"
     - "ESL"
     - "Immigrant"
     - "Migrant"
     - "Refugee"
     - "LGBTQIA"
    default: |
      ESL
progress: 80
---

# This is the main file for the HSC application 
---
metadata:
  title: |
    Hutt Street Centre Community Access Tool 
  short title: |
    Community Access Tool 
  organisation: Flinders University
  show login: True
---
#Jocelyn, can you please help me with inserting this code once we get the photo from HSC? HG This is the flinders logo below. Have inserted HSC one below 
default screen parts:
  post: |
    <div style="display: flex; height: 200px; align-items: flex-end; flex-direction: row-reverse">
    <div style="margin: 5px"><img src="https://staff.flinders.edu.au/etc.clientlibs/flinders/clientlibs/clientlib-site/resources/images/flinderuni_main_logo_black.png" height="40">
    </div>
    <div style="margin: 5px; text-align: right">
    <cite><small><i>
    Developed by Flinders University in collaboration with Hutt Street Centre
    </i></small></cite>
    </div>
    </div>
---
#Will need to insert once we have the names of all the screens
include:
  - HSC.display.output.yml
  - HSC.get.qualifying.services.yml
  - HSC.global.vars.yml
  - HSC.login.yml
  - HSC.questions.yml
  - HSC.csv.yml
---
#added HSC logo
objects:
  - HSCqualifying_agencies: DAList.using(there_are_any=True, auto_gather=False)
  - HSClogo: DAStaticFile.using(filename='HSC_LOGO.jpg')
  - endpoints: DADict
  #- selected_services_key: DADict
---
# J to play around with this workding. 
features:
  css: X2.01.SACAT.css
  debug: True
  hide standard menu: False
---
#HG not amended
mandatory: True
code: |
  # The string below creates the HTML and  inserts into it the logo contained in 
  # the file HSClogo using the python format() method 
  HAAlogostring = '<div class="media"><img src="{}" class="mr-3" height="50"><div class="media-body"></div></div>'.format(HSClogo.url_for())
  # Once we've created the string we use set_parts() to set our new logo metadata
  set_parts(logo=HAAlogostring)
---
# Is this the section where the code will move the user to the welcome screen?  of from the welcome screen, if they 'run app' the end screen there? - HG
mandatory: True
code: |
  # if the user clicks the 'Administration' option -
  if welcome_screen == 'signin':
    # first, ensure that the user is logged in to access this path
    if user_logged_in():
      # then, check that the user is eligible to access this path
      if HSCadmineligible:
        csv_import                   # upload a CSV file
        if HSCadminupload:           # confirm the CSV upload
          write_HSCdata              # write the CSV data to DAStore
          endpoints['HSCfinal_admin']# send to final admin screen
        else:
          endpoints['TERMineligible']# user does not confirm their changes
      # if the user is not eligible to access this path
      else: 
        endpoints['TERMineligible']  # send user to ineligible screen
    # send user to login screen if they're not logged in
    else:
      login_screen
  # else, if the user clicks the 'Application' option - 
  elif welcome_screen == 'proceed':
    # It's a regular user 
    if HSCeligible:
      endpoints['final_screen']
    else:
      endpoints['TERMineligible']
  else:
    # Catch an invalid value
    pass
---
#Will be able to update once I know the codes we are relying on. Jocelyn, happy to use your codes here. HG
event: endpoints['final_screen']
question: Done!
subquestion: |
  Please find below the document listing all your selected services.
  
  You may choose to download this as a word document, or email it directly to either yourself or your client.
  %if HSCcouncil == 'exit':
    endpoints['PCineligible']
  %endif
  <% HSCgender %>
  <% HSCage %>
  <% HSCchildren %>
  <% HSCconcession %>
  <% HSCatsi %>
  <% HSCfactor %>
  % if len(HSCqualifying_services) == 0:
  <% endpoints['no_services'] %>
  % endif
attachment code: |
  HSCprintout
buttons:
  - Exit: exit
    url: https://www.huttstcentre.org.au
  - Restart: restart
---
attachment: 
  - name: Hutt Street Centre Community Access Tool 
    filename: Result Printout
    valid formats:
      - docx
    docx template file: HSC_print_out.docx
    #docx template file: HSC_print_out_test.docx
    variable name: HSCprintout
---
event: endpoints['HSCfinal_admin']
question: Data File Updated
subquestion: |
  The data has been updated with the new CSV file. 
buttons:
  - Exit: exit
    url: https://www.huttstcentre.org.au/
  - Restart: restart
---
event: endpoints['TERMineligible']
question: Not Eligible
subquestion: |
  The disclaimer has not been understood and accepted.  Please exit the
  application or restart if you'd like to accept the disclaimer.
buttons:
  - Exit: exit
    url: https://www.huttstcentre.org.au/
  - Restart: restart
---
event: endpoints['PCineligible']
question: Not Eligible
subquestion: |
  This application does not include information relating to the council you have 
  inserted.  If you would like to restart with a different post code 
  please restart.
#I'm not sure if HSC want to have this as an internal address like an 
#intranet 
buttons:
  - Exit: exit
    url: https://www.huttstcentre.org.au/
  - Restart: restart
---
event: endpoints['no_services']
question: No Services Available
subquestion: |
  Unfortunately, there are no services relevant to your answers.
  
  If you would like to try again, please click the 'Restart' button below.
  
  If you would like to exit the application, please click the 'Exit' button.
buttons:
  - Exit: exit
    url: https://www.huttstcentre.org.au/
  - Restart: restart
---